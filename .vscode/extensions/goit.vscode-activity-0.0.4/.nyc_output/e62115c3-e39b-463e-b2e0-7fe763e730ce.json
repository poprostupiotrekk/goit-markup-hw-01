{"/home/integer/git/vscode-time-tracker/register.js":{"path":"/home/integer/git/vscode-time-tracker/register.js","statementMap":{"0":{"start":{"line":1,"column":15},"end":{"line":1,"column":33}},"1":{"start":{"line":2,"column":21},"end":{"line":2,"column":52}},"2":{"start":{"line":4,"column":0},"end":{"line":8,"column":3}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1},"f":{},"b":{},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7339264a637706b7a21373ef9d88b1d11f981d9c","contentHash":"836f08cf5d0dacba639f5a3e9e2b126eb3ff01338cae5901706bf9375b4a6360"},"/home/integer/git/vscode-time-tracker/src/TimeTrackFSM.ts":{"path":"/home/integer/git/vscode-time-tracker/src/TimeTrackFSM.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":2,"column":62}},"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":46}},"2":{"start":{"line":5,"column":0},"end":{"line":8,"column":50}},"3":{"start":{"line":6,"column":4},"end":{"line":6,"column":38}},"4":{"start":{"line":7,"column":4},"end":{"line":7,"column":46}},"5":{"start":{"line":11,"column":8},"end":{"line":11,"column":32}},"6":{"start":{"line":12,"column":8},"end":{"line":12,"column":44}},"7":{"start":{"line":13,"column":8},"end":{"line":13,"column":43}},"8":{"start":{"line":16,"column":8},"end":{"line":16,"column":27}},"9":{"start":{"line":19,"column":8},"end":{"line":19,"column":28}},"10":{"start":{"line":22,"column":8},"end":{"line":22,"column":45}},"11":{"start":{"line":25,"column":8},"end":{"line":25,"column":41}},"12":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"13":{"start":{"line":27,"column":12},"end":{"line":27,"column":37}},"14":{"start":{"line":31,"column":8},"end":{"line":31,"column":32}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":43}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":37}},"17":{"start":{"line":34,"column":8},"end":{"line":34,"column":38}},"18":{"start":{"line":37,"column":8},"end":{"line":37,"column":108}},"19":{"start":{"line":40,"column":37},"end":{"line":40,"column":38}},"20":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"21":{"start":{"line":42,"column":12},"end":{"line":42,"column":113}},"22":{"start":{"line":44,"column":8},"end":{"line":44,"column":68}},"23":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"24":{"start":{"line":46,"column":12},"end":{"line":46,"column":84}},"25":{"start":{"line":46,"column":47},"end":{"line":46,"column":82}},"26":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"27":{"start":{"line":51,"column":12},"end":{"line":51,"column":43}},"28":{"start":{"line":53,"column":8},"end":{"line":53,"column":37}},"29":{"start":{"line":54,"column":8},"end":{"line":54,"column":43}},"30":{"start":{"line":57,"column":8},"end":{"line":57,"column":36}},"31":{"start":{"line":58,"column":8},"end":{"line":58,"column":38}},"32":{"start":{"line":61,"column":8},"end":{"line":61,"column":33}},"33":{"start":{"line":64,"column":0},"end":{"line":64,"column":36}},"34":{"start":{"line":65,"column":0},"end":{"line":65,"column":30}},"35":{"start":{"line":66,"column":0},"end":{"line":66,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":1},"end":{"line":5,"column":2}},"loc":{"start":{"line":5,"column":18},"end":{"line":8,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":4},"end":{"line":10,"column":5}},"loc":{"start":{"line":10,"column":18},"end":{"line":14,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":16},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":21},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":33},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":13},"end":{"line":29,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":30,"column":4},"end":{"line":30,"column":5}},"loc":{"start":{"line":30,"column":24},"end":{"line":35,"column":5}},"line":30},"7":{"name":"(anonymous_7)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":24},"end":{"line":38,"column":5}},"line":36},"8":{"name":"(anonymous_8)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":34},"end":{"line":48,"column":5}},"line":39},"9":{"name":"(anonymous_9)","decl":{"start":{"line":46,"column":42},"end":{"line":46,"column":43}},"loc":{"start":{"line":46,"column":47},"end":{"line":46,"column":82}},"line":46},"10":{"name":"(anonymous_10)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":17},"end":{"line":55,"column":5}},"line":49},"11":{"name":"(anonymous_11)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":30},"end":{"line":59,"column":5}},"line":56},"12":{"name":"(anonymous_12)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":13},"end":{"line":62,"column":5}},"line":60}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":11},"end":{"line":8,"column":48}},"type":"binary-expr","locations":[{"start":{"line":8,"column":11},"end":{"line":8,"column":24}},{"start":{"line":8,"column":29},"end":{"line":8,"column":47}}],"line":8},"1":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"2":{"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":68}},"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":40}},{"start":{"line":26,"column":44},"end":{"line":26,"column":68}}],"line":26},"3":{"loc":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},{"start":{"line":41,"column":8},"end":{"line":43,"column":9}}],"line":41},"4":{"loc":{"start":{"line":41,"column":12},"end":{"line":41,"column":77}},"type":"binary-expr","locations":[{"start":{"line":41,"column":12},"end":{"line":41,"column":42}},{"start":{"line":41,"column":46},"end":{"line":41,"column":77}}],"line":41},"5":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"6":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":7,"6":7,"7":7,"8":802,"9":18,"10":7,"11":785,"12":785,"13":4,"14":5,"15":5,"16":5,"17":5,"18":660,"19":5,"20":5,"21":5,"22":5,"23":5,"24":3,"25":3,"26":11,"27":6,"28":11,"29":11,"30":6,"31":6,"32":1,"33":1,"34":1,"35":1},"f":{"0":1,"1":7,"2":802,"3":18,"4":7,"5":785,"6":5,"7":660,"8":5,"9":3,"10":11,"11":6,"12":1},"b":{"0":[1,1],"1":[4,781],"2":[785,660],"3":[5,0],"4":[5,5],"5":[3,2],"6":[6,5]},"inputSourceMap":{"version":3,"file":"/home/integer/git/vscode-time-tracker/src/TimeTrackFSM.ts","sources":["/home/integer/git/vscode-time-tracker/src/TimeTrackFSM.ts"],"names":[],"mappings":";;;AAAA,IAAY,KAGX;AAHD,WAAY,KAAK;IACb,iCAAI,CAAA;IACJ,yCAAQ,CAAA;AACZ,CAAC,EAHW,KAAK,GAAL,aAAK,KAAL,aAAK,QAGhB;AAMD,MAAa,YAAY;IAUrB;QACI,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC;QACxB,IAAI,CAAC,gBAAgB,GAAG,IAAI,KAAK,EAAmB,CAAC;QACrD,IAAI,CAAC,yBAAyB,GAAG,CAAC,CAAC;IACvC,CAAC;IAED,IAAI,KAAK;QACL,OAAO,IAAI,CAAC,MAAM,CAAC;IACvB,CAAC;IAED,IAAI,KAAK,CAAC,KAAY;QAClB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IAEM,kBAAkB,CAAC,QAAyB;QAC/C,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACzC,CAAC;IAEM,MAAM;QACT,IAAI,CAAC,yBAAyB,EAAE,CAAC;QAEjC,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,QAAQ,IAAI,IAAI,CAAC,iBAAiB,EAAE,EAAE;YAC1D,IAAI,CAAC,iBAAiB,EAAE,CAAC;SAC5B;IACL,CAAC;IAEO,iBAAiB;QACrB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC;QACxB,IAAI,CAAC,2BAA2B,EAAE,CAAC;QAEnC,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;IAClC,CAAC;IAEO,iBAAiB;QACrB,OAAO,IAAI,CAAC,yBAAyB,GAAG,YAAY,CAAC,YAAY,IAAI,YAAY,CAAC,iBAAiB,CAAC;IACxG,CAAC;IAEO,2BAA2B;QAC/B,IAAI,sBAAsB,GAAG,CAAC,CAAC;QAC/B,IAAI,IAAI,CAAC,gBAAgB,KAAK,IAAI,IAAI,IAAI,CAAC,iBAAiB,KAAK,IAAI,EAAE;YACnE,sBAAsB,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,CAAC,GAAG,IAAI,CAAC;SACxG;QAED,sBAAsB,GAAG,IAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;QAE5D,IAAI,sBAAsB,GAAG,CAAC,EAAE;YAC5B,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC,CAAC,CAAC;SAC3E;IACL,CAAC;IAEM,MAAM,CAAC,IAAU;QACpB,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,EAAE;YAC1B,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;SAClC;QAED,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,IAAI,CAAC,yBAAyB,GAAG,CAAC,CAAC;IACvC,CAAC;IAEO,mBAAmB,CAAC,IAAU;QAClC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC;QAE5B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;IAClC,CAAC;IAEM,MAAM;QACT,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC7B,CAAC;;AA9EL,oCA+EC;AA9EiB,yBAAY,GAAG,CAAC,CAAC;AACjB,8BAAiB,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,YAAY","sourcesContent":["export enum State {\n    wait,\n    interact\n}\n\nexport interface SessionListener {\n    onSession(durationSeconds: number);\n}\n\nexport class TimeTrackFSM {\n    public static TICK_SECONDS = 5;\n    public static IDLE_TIME_SECONDS = 60 * 10; //10 minutes\n\n    private _state: State;\n    private sessionListeners: Array<SessionListener>;\n    private tickCountFromLastInteract: number;\n    private startInteractTime: Date;\n    private lastInteractTime: Date;\n\n    constructor() {\n        this.state = State.wait;\n        this.sessionListeners = new Array<SessionListener>();\n        this.tickCountFromLastInteract = 0;\n    }\n\n    get state(): State {\n        return this._state;\n    }\n\n    set state(value: State) {\n        this._state = value;\n    }\n\n    public addSessionListener(listener: SessionListener) {\n        this.sessionListeners.push(listener);\n    }\n\n    public onTick() {\n        this.tickCountFromLastInteract++;\n\n        if (this.state == State.interact && this.isIdleTimeExpired()) {\n            this.handleInteractEnd();\n        }\n    }\n\n    private handleInteractEnd() {\n        this.state = State.wait;\n        this.notifyListenersAboutSession();\n\n        this.lastInteractTime = null;\n        this.startInteractTime = null;\n    }\n\n    private isIdleTimeExpired() {\n        return this.tickCountFromLastInteract * TimeTrackFSM.TICK_SECONDS >= TimeTrackFSM.IDLE_TIME_SECONDS;\n    }\n\n    private notifyListenersAboutSession() {\n        let sessionDurationSeconds = 0;\n        if (this.lastInteractTime !== null && this.startInteractTime !== null) {\n            sessionDurationSeconds = (this.lastInteractTime.getTime() - this.startInteractTime.getTime()) / 1000;\n        }\n\n        sessionDurationSeconds = Math.floor(sessionDurationSeconds);\n\n        if (sessionDurationSeconds > 0) {\n            this.sessionListeners.forEach(l => l.onSession(sessionDurationSeconds));\n        }\n    }\n\n    public onEdit(time: Date) {\n        if (this.state == State.wait) {\n            this.handleInteractStart(time);\n        }\n\n        this.lastInteractTime = time;\n        this.tickCountFromLastInteract = 0;\n    }\n\n    private handleInteractStart(time: Date) {\n        this.state = State.interact;\n\n        this.startInteractTime = time;\n    }\n\n    public onExit() {\n        this.handleInteractEnd();\n    }\n}"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ddfb00dc3e6b44a03964d5193fb0b1ab648a2906","contentHash":"3d84e2e2874fa07d227ef62eda9ed2f33e834932d57b44bdacca47bddd285997"}}